{"ast":null,"code":"import{Link}from\"react-router-dom\";import{auth,db}from\"../services/firebaseService\";import{signOut}from\"firebase/auth\";import{doc,getDoc}from\"firebase/firestore\";import{useState,useEffect,useRef}from\"react\";import\"../styles/Navbar.css\";// Use useRef para rastrear o scrollY anterior de forma persistente\nimport{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const HIDE_THRESHOLD=80;export default function Navbar(){const[user,setUser]=useState(null);const[userName,setUserName]=useState(null);// NOVO ESTADO: Inicialmente true para evitar renderizar o email\nconst[isLoadingName,setIsLoadingName]=useState(true);const[isVisible,setIsVisible]=useState(true);const lastScrollY=useRef(0);// Lógica de Scroll (mantida do passo anterior)\nconst handleScroll=()=>{const currentScrollY=window.scrollY;if(currentScrollY<HIDE_THRESHOLD){setIsVisible(true);}else if(currentScrollY>lastScrollY.current){setIsVisible(false);}else if(currentScrollY<lastScrollY.current){setIsVisible(true);}lastScrollY.current=currentScrollY;};// 1. useEffect Principal: Autenticação e Scroll\nuseEffect(()=>{const unsubscribeAuth=auth.onAuthStateChanged(u=>setUser(u));window.addEventListener('scroll',handleScroll);return()=>{unsubscribeAuth();window.removeEventListener('scroll',handleScroll);};},[]);// 2. Novo useEffect: Buscar o nome no Firestore quando o usuário logar\nuseEffect(()=>{// Resetar o estado ao iniciar a busca\nsetIsLoadingName(true);setUserName(null);if(user){const fetchUserName=async()=>{try{const userDocRef=doc(db,\"usuarios\",user.uid);const userDoc=await getDoc(userDocRef);let finalName=user.email.split('@')[0];// Fallback: Parte do email\nif(userDoc.exists()&&userDoc.data().nome){finalName=userDoc.data().nome.split(' ')[0];// Usa a primeira palavra do nome\n}setUserName(finalName);}catch(error){console.error(\"Erro ao buscar nome do usuário:\",error);// O fallback para o email já está em finalName\n}finally{// IMPORTANTE: O carregamento é definido como falso APÓS a busca, \n// garantindo que o userName já esteja preenchido (nome ou email).\nsetIsLoadingName(false);}};fetchUserName();}else{// Se não há usuário, não há carregamento\nsetIsLoadingName(false);setUserName(null);}},[user]);// Roda sempre que o estado 'user' mudar\nconst handleLogout=async()=>{await signOut(auth);};const navbarClasses=\"navbar \".concat(isVisible?'navbar-visible':'navbar-hidden');// 3. Renderização: Usar o userName e isLoadingName\nreturn/*#__PURE__*/_jsxs(\"nav\",{className:navbarClasses,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"navbar-left\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"menu-button\",children:\"\\u2630\"}),/*#__PURE__*/_jsx(Link,{to:\"/\",style:{textDecoration:'none',color:'inherit'},children:/*#__PURE__*/_jsx(\"span\",{className:\"logo\",children:\"Checkup Azul\"})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"navbar-right\",children:!user?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Link,{to:\"/login\",className:\"nav-button login-btn\",children:\"Login\"}),/*#__PURE__*/_jsx(Link,{to:\"/cadastro\",className:\"nav-button signup-btn\",children:\"Sign Up\"})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"span\",{className:\"user-text\",children:[\"Ol\\xE1, \",isLoadingName?'Carregando...':userName||'Usuário']}),/*#__PURE__*/_jsx(\"button\",{onClick:handleLogout,className:\"nav-button logout-btn\",children:\"Logout\"})]})})]});}","map":{"version":3,"names":["Link","auth","db","signOut","doc","getDoc","useState","useEffect","useRef","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","HIDE_THRESHOLD","Navbar","user","setUser","userName","setUserName","isLoadingName","setIsLoadingName","isVisible","setIsVisible","lastScrollY","handleScroll","currentScrollY","window","scrollY","current","unsubscribeAuth","onAuthStateChanged","u","addEventListener","removeEventListener","fetchUserName","userDocRef","uid","userDoc","finalName","email","split","exists","data","nome","error","console","handleLogout","navbarClasses","concat","className","children","to","style","textDecoration","color","onClick"],"sources":["C:/Users/maxka/saude-homem-web/src/components/Navbar.js"],"sourcesContent":["import { Link } from \"react-router-dom\";\r\nimport { auth, db } from \"../services/firebaseService\"; \r\nimport { signOut } from \"firebase/auth\";\r\nimport { doc, getDoc } from \"firebase/firestore\";\r\nimport { useState, useEffect, useRef } from \"react\";\r\nimport \"../styles/Navbar.css\";\r\n\r\n// Use useRef para rastrear o scrollY anterior de forma persistente\r\nconst HIDE_THRESHOLD = 80;\r\n\r\nexport default function Navbar() {\r\n  const [user, setUser] = useState(null);\r\n  const [userName, setUserName] = useState(null); \r\n  // NOVO ESTADO: Inicialmente true para evitar renderizar o email\r\n  const [isLoadingName, setIsLoadingName] = useState(true); \r\n  const [isVisible, setIsVisible] = useState(true);\r\n  const lastScrollY = useRef(0);\r\n\r\n  // Lógica de Scroll (mantida do passo anterior)\r\n  const handleScroll = () => {\r\n    const currentScrollY = window.scrollY;\r\n\r\n    if (currentScrollY < HIDE_THRESHOLD) { \r\n      setIsVisible(true);\r\n    } \r\n    else if (currentScrollY > lastScrollY.current) {\r\n      setIsVisible(false);\r\n    } \r\n    else if (currentScrollY < lastScrollY.current) {\r\n      setIsVisible(true);\r\n    }\r\n    \r\n    lastScrollY.current = currentScrollY;\r\n  };\r\n\r\n  // 1. useEffect Principal: Autenticação e Scroll\r\n  useEffect(() => {\r\n    const unsubscribeAuth = auth.onAuthStateChanged(u => setUser(u));\r\n    window.addEventListener('scroll', handleScroll);\r\n\r\n    return () => {\r\n      unsubscribeAuth();\r\n      window.removeEventListener('scroll', handleScroll);\r\n    };\r\n  }, []);\r\n\r\n  // 2. Novo useEffect: Buscar o nome no Firestore quando o usuário logar\r\n  useEffect(() => {\r\n    // Resetar o estado ao iniciar a busca\r\n    setIsLoadingName(true); \r\n    setUserName(null); \r\n    \r\n    if (user) {\r\n      const fetchUserName = async () => {\r\n        try {\r\n          const userDocRef = doc(db, \"usuarios\", user.uid);\r\n          const userDoc = await getDoc(userDocRef);\r\n          \r\n          let finalName = user.email.split('@')[0]; // Fallback: Parte do email\r\n          \r\n          if (userDoc.exists() && userDoc.data().nome) {\r\n            finalName = userDoc.data().nome.split(' ')[0]; // Usa a primeira palavra do nome\r\n          }\r\n          \r\n          setUserName(finalName);\r\n        } catch (error) {\r\n          console.error(\"Erro ao buscar nome do usuário:\", error);\r\n          // O fallback para o email já está em finalName\r\n        } finally {\r\n          // IMPORTANTE: O carregamento é definido como falso APÓS a busca, \r\n          // garantindo que o userName já esteja preenchido (nome ou email).\r\n          setIsLoadingName(false); \r\n        }\r\n      };\r\n      \r\n      fetchUserName();\r\n      \r\n    } else {\r\n      // Se não há usuário, não há carregamento\r\n      setIsLoadingName(false);\r\n      setUserName(null); \r\n    }\r\n  }, [user]); // Roda sempre que o estado 'user' mudar\r\n\r\n  const handleLogout = async () => {\r\n    await signOut(auth);\r\n  };\r\n\r\n  const navbarClasses = `navbar ${isVisible ? 'navbar-visible' : 'navbar-hidden'}`;\r\n\r\n  // 3. Renderização: Usar o userName e isLoadingName\r\n  return (\r\n    <nav className={navbarClasses}>\r\n      <div className=\"navbar-left\">\r\n        <button className=\"menu-button\">☰</button>\r\n        <Link to=\"/\" style={{ textDecoration: 'none', color: 'inherit' }}>\r\n        <span className=\"logo\">Checkup Azul</span>\r\n        </Link>\r\n      </div>\r\n\r\n      <div className=\"navbar-right\">\r\n        {!user ? (\r\n          <>\r\n            <Link to=\"/login\" className=\"nav-button login-btn\">Login</Link>\r\n            <Link to=\"/cadastro\" className=\"nav-button signup-btn\">Sign Up</Link>\r\n          </>\r\n        ) : (\r\n          <>\r\n            {/* Exibe 'Olá, Carregando...' durante a busca, ou 'Olá, [Nome/Email]' após a busca. */}\r\n            <span className=\"user-text\">\r\n                Olá, {isLoadingName ? 'Carregando...' : userName || 'Usuário'}\r\n            </span> \r\n            \r\n            <button onClick={handleLogout} className=\"nav-button logout-btn\">\r\n              Logout\r\n            </button>\r\n          </>\r\n        )}\r\n      </div>\r\n    </nav>\r\n  );\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}